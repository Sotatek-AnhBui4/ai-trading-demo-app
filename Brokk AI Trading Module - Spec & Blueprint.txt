Brokk AI Trading Module - Spec & Blueprint
1) What this module does (in one line)
Continuously converts global sentiment + market data into probability-weighted trade plans that aim to hit a user-defined goal (e.g., “+5% in 60 days”), executes with guardrails, and explains every decision.


2) Core user stories
* Goal based: “I have $10,000. Target +5% in 60 days. Medium risk. No leverage. Max drawdown 3%.”
* Sentiment calls: “Show me Strong Buy / Strong Sell for top 50 coins by market cap, with 1D/1W/1M horizons and confidence scores.”
* Hands-off execution: “Auto-rebalance daily; exit to USDC if VaR exceeds 2% on any day.”
* Transparency: “Why did you buy SOL today?” → See signals, sentiment sources, on-chain indicators, and risk checks.
* Controls: “Never hold more than 20% in any single asset. Disable perpetuals. Only spot on exchange X.”


3) Guardrails & compliance (must-haves)
        •        No promise of returns: Frame goals as targets with probability bands (e.g., 62% chance to hit +5% in 60 days under current conditions).
        •        Suitability profile: Risk score, horizon, experience, leverage permission, loss tolerance; block strategies that don’t fit the profile.
        •        Investment Policy Statement (IPS) per user: codified constraints (per-asset caps, sectors allowed, leverage, max daily VaR, max portfolio drawdown, slippage tolerance).
        •        Pre-trade checks: KYC/AML status, geo/venue eligibility, asset allowlist/denylist, leverage eligibility.
        •        Post-trade surveillance: Abnormal pnl, wash-trade patterns, concentration spikes.
        •        Audit trail: Immutable logs: data snapshot → model outputs → decision → order → fills → PnL → notifications.
        •        Explainability: Human-readable reasons & source links (news headline, funding rate spike, whale flows, etc.).
        •        Disclosures: Prominently surface risk and that outcomes are probabilistic.


4) System architecture (high level)
Ingestion layer
        •        Market: price/volume, order books, funding rates, OI, perp basis, vol surfaces.
        •        On-chain: net flows (CEX :left_right_arrow: DEX), whale wallets, stablecoin issuance/flows, staking unlocks.
        •        Sentiment: news, X/Twitter, Reddit, Telegram/Discord (public), Google Trends; NER + stance detection; source trust scores.
        •        Macro: DXY, rates, BTC dominance, cross-asset risk (VIX), calendar (CPI/FOMC), event feeds (token unlocks, ETF flows).
Feature store & labeler
        •        Normalized features (z-scores, rolling stats), curated factor library, label generation (forward returns @ 1D/1W/1M).
Modeling layer
        •        Short-horizon: gradient boosted trees / temporal CNNs for 1D/1W directional edges.
        •        Medium-horizon: regime classifier (volatility, liquidity regimes) + meta-policy selector.
        •        Sentiment model: multi-source transformer with source reliability weighting + time-decay.
        •        Uncertainty: calibration via Platt/Isotonic; conformal prediction for intervals.
        •        Explainability: SHAP/LIME on decision snapshots.
Decision engine
        •        Combines model scores → signal strength → maps to Strong Buy / Buy / Neutral / Sell / Strong Sell per timeframe.
        •        Goal-seeking optimizer (see §7) converts goal + constraints into a trade plan (allocations + schedules + exits).
Execution layer
        •        Venue router (Talos/Devexperts or your broker stack): smart order routing, TWAP/VWAP/POV, partial fills, slippage caps.
        •        Custody/settlement via Fireblocks policies; withdrawal/approval limits; address allowlists.
Risk & compliance
        •        Real-time VaR, expected shortfall, per-asset and portfolio limits, circuit-breaker (“freeze to stablecoin”).
        •        Policy engine enforces IPS & regulatory constraints before any order is sent.
Feedback, monitoring & ops
        •        Live PnL, drift vs target pathway to goal, model drift, data latency, incident alerts, AB tests.
        •        Shadow mode / paper trading before enabling real trading for a new user or strategy.
5) Data & signals (pragmatic set to start)
        •        Price/action: OHLCV (1m/5m/1h/1d), spreads, liquidity buckets.
        •        Derivatives: funding rate, basis, OI changes, liquidations map (heat).
        •        On-chain: addresses growth, CEX inflows/outflows, whale wallet net flow, stablecoin mints/burns.
        •        Sentiment:
        •        News entity-level polarity with credibility weights.
        •        Social signals (volume, velocity, valence), bot filtering, influencer whitelists.
        •        Topic heat (e.g., “ETF inflows”, “protocol hack”, “partnership”).
        •        Macro: BTC dominance, DXY, S&P futures correlation regimes.
        •        Calendars: token unlocks, governance votes, listings, major macro prints.


6) Strong Buy/Sell scoring
For each asset A and horizon H ∈ {1D, 1W, 1M}:
        •        Compute directional probability p_up(A,H) from ensemble.
        •        Compute expected move μ(A,H) and calibrated confidence c(A,H).
        •        Map to label:
        •        Strong Buy if p_up>0.62, μ>threshold(H), c>0.6 and risk filters pass.
        •        Strong Sell symmetrical on downside (or “Hedge” if shorting/leverage restricted).
        •        Always attach reasons (top 3 features + links) and risk flags (e.g., “unlock in 2d”).


7) Goal-seeking planner (how “+5% in 60 days” works)
Input: capital C, horizon T=60d, target return R=+5%, risk bounds (max drawdown Dmax=3%, daily VaR≤2%), constraints (spot only, per-asset cap 20%).
Process:
* Regime detect (bull, chop, bear, high-vol).
* Candidate strategies (weights + tactics):
        •        Momentum (time-filtered) on BTC/ETH/L1s
        •        Carry/funding capture (if allowed)
        •        Mean-reversion on large caps
        •        Event-driven (ETF flows, unlocks, listings)
        •        Defensive sleeve (BTC/ETH + stablecoin)
* Scenario engine:
        •        Simulate 10k paths using bootstrapped blocks per regime; include slippage/fees.
        •        Constrain solutions by IPS and risk (ES, VaR, drawdown).
* Optimizer:
        •        Maximize P(ending value ≥ C×1.05) subject to constraints.
        •        Secondary objective: minimize tail risk (CVaR@95).
* Trade plan output:
        •        Initial allocation (e.g., 40% BTC momentum, 25% ETH carry off, 20% SOL momentum with tight stop, 15% stablecoin buffer).
        •        Execution schedule, rebal frequency, stop/TP grid, circuit-breakers.
* Pathway tracker:
        •        Daily “on-track probability” and gap to target; if behind, propose an adaptive plan (tighten risk or pivot strategy), requiring user approval if it increases risk.


8) Risk controls (enforced in code)
        •        Per-asset cap, sector cap, blacklist.
        •        No leverage / no derivatives (toggleable).
        •        Max daily VaR, max portfolio drawdown, per-order slippage.
        •        Time-outs around major prints (e.g., 10m pre/post CPI if enabled).
        •        Kill switch: auto-move to stablecoin if breach; notify user.


9) UX & flows (quick sketch)
        •        Goals tab: Create goal → choose target (+5%), horizon (60d), risk level (conservative/moderate/aggressive), constraints.
        •        Signals tab: Strong Buy/Sell board with horizons, confidence, and reasons.
        •        Plan view: Allocations, tactics, next rebal time, current “Probability to Hit Target”, “On-Track/Behind” badge.
        •        Explain modal: “Why SOL?” → sentiment surge + whale inflows + funding normalization; links to sources.
        •        Controls: Toggles for “Disable leverage”, “Pause trading”, “Tighten stops”, “Exit to USDC”.
        •        Compliance strip: Disclosures, IPS summary, change log.
10) APIs (example schemas)
Create Goal
POST /v1/goals
{
  "capital_usd": 10000,
  "target_return_pct": 5,
  "horizon_days": 60,
  "risk_profile": "moderate",
  "constraints": {
    "spot_only": true,
    "max_asset_weight_pct": 20,
    "max_drawdown_pct": 3,
    "max_daily_var_pct": 2,
    "blacklist": ["MemeX"]
  }
}
Response
{
  "goal_id": "g_789",
  "prob_to_hit": 0.62,
  "plan": {
    "allocations": [{"asset":"BTC","weight":0.40}, {"asset":"ETH","weight":0.20}, {"asset":"SOL","weight":0.25}, {"asset":"USDC","weight":0.15}],
    "exec": {"style": "TWAP", "rebalance_hours": 24},
    "stops": [{"asset":"SOL","type":"trailing","value_pct":3}],
    "circuit_breakers": {"to_stable_on_drawdown_pct":3}
  },
  "explain": ["Regime=bullish-chop", "Funding normalized", "Whale inflows in SOL"]
}
Get Signals
GET /v1/signals?horizon=1w
[
  {"asset":"BTC","label":"Buy","prob_up":0.58,"expected_move_pct":2.1,"confidence":0.61},
  {"asset":"SOL","label":"Strong Buy","prob_up":0.67,"expected_move_pct":6.4,"confidence":0.66,"reasons":["Sentiment +","Whale inflows","+Momentum"]},
  {"asset":"DOGE","label":"Sell","prob_up":0.42,"expected_move_pct":-3.2,"confidence":0.55}
]
Execute Plan
POST /v1/trade-plans/{goal_id}/execute
{"dry_run": false, "confirm_changes": true}
11) Backtesting & validation
        •        Walk-forward with regime awareness; avoid look-ahead by strict feature windows and realistic latency.
        •        Transaction-cost model per venue (fees + slippage by book depth).
        •        Stress tests: gap opens, liquidity vanishing, funding spikes, volatility compression/expansion.
        •        Metrics: hit-probability to target vs baseline, max DD, Calmar, Sortino, turnover, capacity.


12) Monitoring & ops
        •        Dashboards: model drift, feature health, data latency, fill rates, slippage vs quote, alerting on breaches.
        •        Canary rollout: paper → $100 sandbox → user-cap throttles.
        •        Incident runbooks: data outage, venue rejects, custody hold, risk breach.


13) Tech stack pointers
        •        Pipelines: Python + Spark/Flink for streaming; Kafka for buses; Feast for feature store.
        •        Models: PyTorch/LightGBM; MLflow for versioning; SHAP for explainability.
        •        Orchestration: Airflow; infra on AWS.
        •        Execution: Talos/Devexperts (routing, algos), Fireblocks (custody/policies).
        •        DBs: TimescaleDB/ClickHouse for tick + features; Postgres for control plane.


14) Example: “$10k → +5% in 60 days”
        •        User IPS: Moderate; spot only; Dmax 3%; VaR 2%/day; per-asset cap 20%.
        •        System output:
        •        Plan: 40% BTC (trend), 20% ETH (trend), 25% SOL (momentum tactical with tight trailing stop), 15% USDC buffer.
        •        Rebal: daily 16:00 UTC; skip if spread>0.25% or book depth < threshold.
        •        Stops: SOL trailing 3%, BTC 2%, ETH 2%.
        •        Circuit: Move to USDC if portfolio DD hits 3% or regime flips to “bear-high-vol”.
        •        Today exec: TWAP 60 min to limit slippage.
        •        Live telemetry: Prob to hit = 0.62; On-track = true; Path gap = –0.3% to curve.


15) What to build first
        •        IPS + risk policy engine (non-negotiable).
        •        Signals board with explainability.
        •        A single, conservative Goal Plan v1 (BTC/ETH + stable buffer) to validate the full loop.
        •        Paper trading for 2 weeks with alerts → small real-money guardrailed beta.